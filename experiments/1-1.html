<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基物实验助手 - 稳态法测量不良导体热导率</title>
    <!-- 公共样式 -->
    <link rel="stylesheet" href="style.css">
    <!-- 公共工具库 -->
    <script src="common.js"></script>
    <!-- MathJax 配置 -->
    <script>
        MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], processEscapes: true },
            svg: { fontCache: 'global' }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-svg.js" id="MathJax-script" async></script>
</head>
<body>
<div class="container">
    <div class="page-title">稳态法测量不良导体热导率</div>

    <!-- 实验要点提示 -->
    <div class="tip-box">
        <strong>Tips</strong><br>
        • $x_0$ (mm) 为游标卡尺零点读数<br>
        • $\theta_1$, $\theta_2$ (°C) 为两盘稳态温度<br>
        • 降温曲线取两点作切线，$\Delta\theta$ (°C)为纵坐标之差, $\Delta t$ (s)为横坐标之差
    </div>

    <!-- 原始数据录入区 -->
    <div class="section">
        <div class="section-title">原始数据录入</div>

        <!-- 游标卡尺零点 -->
        <div class="top-input-group" style="margin-bottom: 1rem;">
            <div class="top-input">
                <label>$x_0$ (mm):</label>
                <input type="number" id="x0" class="save-input cell-input" step="0.01" value="0.00">
            </div>
        </div>

        <!-- 散热盘P 表格容器 -->
        <div style="margin-bottom: 2rem;">
            <div style="font-weight: 500; margin-bottom: 0.5rem;">散热盘P (5次测量)</div>
            <div id="p-table-container" class="data-table"></div>
        </div>

        <!-- 样品B 表格容器 -->
        <div style="margin-bottom: 2rem;">
            <div style="font-weight: 500; margin-bottom: 0.5rem;">样品B (5次测量)</div>
            <div id="b-table-container" class="data-table"></div>
        </div>

        <!-- 稳态及作图参数 -->
        <div class="top-input-group" style="flex-wrap: wrap; gap: 1.5rem;">
            <div class="top-input"><label>$\theta_1$ (°C):</label><input type="number" id="theta1" class="save-input cell-input" step="0.01" value=""></div>
            <div class="top-input"><label>$\theta_2$ (°C):</label><input type="number" id="theta2" class="save-input cell-input" step="0.01" value=""></div>
            <div class="top-input"><label>$\Delta\theta$ (°C):</label><input type="number" id="deltaTheta" class="save-input cell-input" step="0.01" value=""></div>
            <div class="top-input"><label>$\Delta t$ (s):</label><input type="number" id="deltaT" class="save-input cell-input" step="0.01" value=""></div>
            <div class="top-input"><label>纵轴一小格代表的温度 (°C):</label><input type="number" id="uThetaPerDivision" class="save-input cell-input" step="0.01" value="0.10"></div>
            <div class="top-input"><label>横轴一小格代表的时间 (s):</label><input type="number" id="uTimePerDivision" class="save-input cell-input" step="0.01" value="1.00"></div>
        </div>
    </div>

    <!-- 操作按钮组 -->
    <div class="action-buttons">
        <button class="primary" id="calculateBtn">计算并保存</button>
        <button id="saveBtn">仅保存数据</button>
    </div>

    <!-- 主要结果卡片 -->
    <div class="section" id="resultMain" style="display: none;">
        <div class="section-title">测量结果</div>
        <div class="result-grid">
            <div class="result-card"><div class="result-label">热导率 $K$ (W/(m·K))</div><div class="result-value" id="k_val">—</div></div>
            <div class="result-card"><div class="result-label">合成不确定度 $u(K)$ (W/(m·K))</div><div class="result-value" id="uk_val">—</div></div>
            <div class="result-card"><div class="result-label">相对不确定度 $u(K)/K$</div><div class="result-value" id="rel_uk_val">—</div></div>
        </div>
    </div>

    <!-- 详细计算过程 -->
    <div class="section" id="processSection" style="display: none;">
        <div class="section-title">详细计算过程</div>
        <div class="process-container" id="calculationProcess"></div>
    </div>

    <!-- 免责声明 -->
    <div class="disclaimer" style="text-align: center;">开源项目禁止商用 ｜ 自行核对计算数据</div>
</div>

<script>
(function() {
    const APP_KEY = '1-1';

    // ---------- 获取所有输入值（零点修正）----------
    function getInputs() {
        const x0 = parseFloat(document.getElementById('x0').value) || 0;

        // 读取散热盘P表格数据 (id: p_1~p_15)
        const p_mass = [], p_height = [], p_diameter = [];
        for (let i = 0; i < 5; i++) {
            const mass = parseFloat(document.getElementById(`p_${i*3+1}`)?.value);
            const height = parseFloat(document.getElementById(`p_${i*3+2}`)?.value);
            const dia = parseFloat(document.getElementById(`p_${i*3+3}`)?.value);
            p_mass.push(isNaN(mass) ? NaN : mass);
            p_height.push(isNaN(height) ? NaN : height - x0);
            p_diameter.push(isNaN(dia) ? NaN : dia - x0);
        }

        // 读取样品B表格数据 (id: b_1~b_10)
        const b_height = [], b_diameter = [];
        for (let i = 0; i < 5; i++) {
            const h = parseFloat(document.getElementById(`b_${i*2+1}`)?.value);
            const d = parseFloat(document.getElementById(`b_${i*2+2}`)?.value);
            b_height.push(isNaN(h) ? NaN : h - x0);
            b_diameter.push(isNaN(d) ? NaN : d - x0);
        }

        const theta1 = parseFloat(document.getElementById('theta1').value);
        const theta2 = parseFloat(document.getElementById('theta2').value);
        const deltaTheta = parseFloat(document.getElementById('deltaTheta').value);
        const deltaT = parseFloat(document.getElementById('deltaT').value);
        const uThetaPerDiv = parseFloat(document.getElementById('uThetaPerDivision').value) || 0.1;
        const uTimePerDiv = parseFloat(document.getElementById('uTimePerDivision').value) || 1.0;

        return {
            x0, p_mass, p_height, p_diameter, b_height, b_diameter,
            theta1, theta2, deltaTheta, deltaT,
            uThetaPerDiv, uTimePerDiv
        };
    }

    // ---------- 数据有效性检查 ----------
    function isValid(data) {
        const allArrays = [data.p_mass, data.p_height, data.p_diameter, data.b_height, data.b_diameter];
        for (let arr of allArrays) {
            if (arr.length !== 5 || arr.some(v => isNaN(v))) return false;
        }
        if (isNaN(data.theta1) || isNaN(data.theta2) || isNaN(data.deltaTheta) || isNaN(data.deltaT)) return false;
        if (data.theta1 <= data.theta2) return false;
        if (data.deltaT <= 0) return false;
        return true;
    }

    // ---------- 核心计算 ----------
    function compute(data) {
        const { p_mass, p_height, p_diameter, b_height, b_diameter,
                theta1, theta2, deltaTheta, deltaT, uThetaPerDiv, uTimePerDiv } = data;

        // 使用 common.js 中的统计函数
        const Data = window.ExperimentUtils.Data;
        const avgMass = Data.mean(p_mass);
        const avgHp = Data.mean(p_height);
        const avgDp = Data.mean(p_diameter);
        const avgHb = Data.mean(b_height);
        const avgDb = Data.mean(b_diameter);

        const uMassA = Data.stdErrorOfMean(p_mass);
        const uHpA = Data.stdErrorOfMean(p_height);
        const uDpA = Data.stdErrorOfMean(p_diameter);
        const uHbA = Data.stdErrorOfMean(b_height);
        const uDbA = Data.stdErrorOfMean(b_diameter);

        // B类不确定度
        const uMassB = 0.01 / Math.sqrt(3);
        const uHpB = 0.02 / Math.sqrt(3);
        const uDpB = 0.02 / Math.sqrt(3);
        const uHbB = 0.02 / Math.sqrt(3);
        const uDbB = 0.02 / Math.sqrt(3);

        const uDeltaThetaB = (uThetaPerDiv / 2) / Math.sqrt(3);
        const uDeltaTB = (uTimePerDiv / 2) / Math.sqrt(3);
        const uThetaDiff = Math.sqrt(2) * uDeltaThetaB;

        const uMassC = Math.hypot(uMassA, uMassB);
        const uHpC = Math.hypot(uHpA, uHpB);
        const uDpC = Math.hypot(uDpA, uDpB);
        const uHbC = Math.hypot(uHbA, uHbB);
        const uDbC = Math.hypot(uDbA, uDbB);

        const dthetaDt = deltaTheta / deltaT;
        const thetaDiff = theta1 - theta2;

        // 热导率 K (单位转换)
        const Cp = 389;
        const mp_kg = avgMass / 1000;
        const hp_m = avgHp / 1000;
        const dp_m = avgDp / 1000;
        const hb_m = avgHb / 1000;
        const db_m = avgDb / 1000;

        const termA = mp_kg * Cp * dthetaDt;
        const termB = (dp_m + 4 * hp_m) / (dp_m + 2 * hp_m);
        const termC = hb_m / thetaDiff;
        const termD = 2 / (Math.PI * db_m * db_m);
        const K = termA * termB * termC * termD;

        // 相对不确定度分量
        const relMass2 = (uMassC / avgMass) ** 2;
        const relDthetaDt2 = (uDeltaThetaB / deltaTheta) ** 2 + (uDeltaTB / deltaT) ** 2;
        const denom = (avgDp + 4 * avgHp) * (avgDp + 2 * avgHp);
        const termG1 = (2 * avgHp * uDpC) / denom;
        const termG2 = (2 * avgDp * uHpC) / denom;
        const relGeo2 = termG1**2 + termG2**2;
        const relHb2 = (uHbC / avgHb) ** 2;
        const relDb2 = (2 * uDbC / avgDb) ** 2;
        const relThetaDiff2 = (uThetaDiff / thetaDiff) ** 2;

        const relU = Math.sqrt(relMass2 + relDthetaDt2 + relGeo2 + relHb2 + relDb2 + relThetaDiff2);
        const uK = K * relU;

        return {
            // 原始数组
            massArr: p_mass, hpArr: p_height, dpArr: p_diameter, hbArr: b_height, dbArr: b_diameter,
            avgMass, avgHp, avgDp, avgHb, avgDb,
            uMassA, uHpA, uDpA, uHbA, uDbA,
            uMassB, uHpB, uDpB, uHbB, uDbB,
            uDeltaThetaB, uDeltaTB, uThetaDiff,
            uMassC, uHpC, uDpC, uHbC, uDbC,
            dthetaDt, thetaDiff,
            relDthetaDt2, relGeo2,
            K, uK, relU,
            deltaTheta, deltaT, uThetaPerDiv, uTimePerDiv,
            theta1, theta2, x0: data.x0
        };
    }

    // ---------- 渲染详细计算过程 ----------
    function renderProcess(res) {
        const [kDisplay, ukDisplay] = window.ExperimentUtils.formatResultWithUncertainty(res.K, res.uK);

        // 辅助：生成残差平方字符串
        const formatResiduals = (arr, mean) => arr.map(v => {
            const diff = v - mean;
            return (diff < 0 ? `(${diff.toFixed(4)})` : diff.toFixed(4)) + '²';
        }).join(' + ');

        const html = `
        <div class="calculation-step">
        <div class="step-title">1. 原始数据与零点修正</div>
            <div style="margin-top: 1rem; font-weight: 500;">散热盘P测量数据（零点修正后）</div>
            <div class="output-table-wrapper">
                <table class="output-table">
                    <thead>
                        <tr>
                            <th>次数</th>
                            <th>质量 m<sub>p</sub> (g)</th>
                            <th>高度 h<sub>p</sub> (mm)</th>
                            <th>直径 d<sub>p</sub> (mm)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${[0,1,2,3,4].map(i => `
                        <tr>
                            <td>${i+1}</td>
                            <td>${res.massArr[i].toFixed(4)}</td>
                            <td>${res.hpArr[i].toFixed(4)}</td>
                            <td>${res.dpArr[i].toFixed(4)}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 1.5rem; font-weight: 500;">样品B测量数据（零点修正后）</div>
            <div class="output-table-wrapper">
                <table class="output-table">
                    <thead>
                        <tr>
                            <th>次数</th>
                            <th>高度 h<sub>b</sub> (mm)</th>
                            <th>直径 d<sub>b</sub> (mm)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${[0,1,2,3,4].map(i => `
                        <tr>
                            <td>${i+1}</td>
                            <td>${res.hbArr[i].toFixed(4)}</td>
                            <td>${res.dbArr[i].toFixed(4)}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="calculation-step">
            <div class="step-title">2. 平均值计算</div>
            <div class="step-formula">$$\\bar{m}_p = \\frac{${res.massArr.map(v => v.toFixed(4)).join('+')}}{5} = ${res.avgMass.toFixed(4)}\\ \\mathrm{g}$$</div>
            <div class="step-formula">$$\\bar{h}_p = \\frac{${res.hpArr.map(v => v.toFixed(4)).join('+')}}{5} = ${res.avgHp.toFixed(4)}\\ \\mathrm{mm}$$</div>
            <div class="step-formula">$$\\bar{d}_p = \\frac{${res.dpArr.map(v => v.toFixed(4)).join('+')}}{5} = ${res.avgDp.toFixed(4)}\\ \\mathrm{mm}$$</div>
            <div class="step-formula">$$\\bar{h}_b = \\frac{${res.hbArr.map(v => v.toFixed(4)).join('+')}}{5} = ${res.avgHb.toFixed(4)}\\ \\mathrm{mm}$$</div>
            <div class="step-formula">$$\\bar{d}_b = \\frac{${res.dbArr.map(v => v.toFixed(4)).join('+')}}{5} = ${res.avgDb.toFixed(4)}\\ \\mathrm{mm}$$</div>
        </div>

        <div class="calculation-step">
            <div class="step-title">3. A类不确定度</div>
            <div class="step-formula">$u_A(m_p) = \\sqrt{\\frac{${formatResiduals(res.massArr, res.avgMass)}}{5×4}} = ${res.uMassA.toFixed(6)}$ g</div>
            <div class="step-formula">$u_A(h_p) = \\sqrt{\\frac{${formatResiduals(res.hpArr, res.avgHp)}}{5×4}} = ${res.uHpA.toFixed(6)}$ mm</div>
            <div class="step-formula">$u_A(d_p) = \\sqrt{\\frac{${formatResiduals(res.dpArr, res.avgDp)}}{5×4}} = ${res.uDpA.toFixed(6)}$ mm</div>
            <div class="step-formula">$u_A(h_b) = \\sqrt{\\frac{${formatResiduals(res.hbArr, res.avgHb)}}{5×4}} = ${res.uHbA.toFixed(6)}$ mm</div>
            <div class="step-formula">$u_A(d_b) = \\sqrt{\\frac{${formatResiduals(res.dbArr, res.avgDb)}}{5×4}} = ${res.uDbA.toFixed(6)}$ mm</div>
        </div>

        <div class="calculation-step">
            <div class="step-title">4. B类不确定度</div>
            <div class="step-formula">$u_B(m_p) = \\frac{0.01}{\\sqrt{3}} = ${res.uMassB.toFixed(6)}$ g</div>
            <div class="step-formula">$u_B(h_p) = u_B(d_p) = u_B(h_b) = u_B(d_b) = \\frac{0.02}{\\sqrt{3}} = ${res.uHpB.toFixed(6)}$ mm</div>
            <div class="step-formula">$u_B(\\Delta\\theta) = \\frac{${res.uThetaPerDiv}/2}{\\sqrt{3}} = ${res.uDeltaThetaB.toFixed(6)}$ °C</div>
            <div class="step-formula">$u_B(\\Delta t) = \\frac{${res.uTimePerDiv}/2}{\\sqrt{3}} = ${res.uDeltaTB.toFixed(6)}$ s</div>
            <div class="step-formula">$u_B(\\theta_1-\\theta_2) = \\sqrt{u_B(\\theta_1)^2+u_B(\\theta_2)^2} = \\sqrt{2} u_B(\\Delta\\theta) =\\sqrt{2} \\times ${res.uDeltaThetaB.toFixed(6)} = ${res.uThetaDiff.toFixed(6)}$ °C</div>
        </div>

        <div class="calculation-step">
            <div class="step-title">5. 降温速率及不确定度</div>
            <div class="step-formula">$$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}t} = \\frac{${res.deltaTheta}}{${res.deltaT}} = ${res.dthetaDt.toFixed(6)}\\ \\mathrm{°C/s}$$</div>
            <div class="step-formula">相对不确定度: $\\frac{u(\\mathrm{d}\\theta/\\mathrm{d}t)}{\\mathrm{d}\\theta/\\mathrm{d}t} = \\sqrt{\\left(\\frac{u(\\Delta\\theta)}{\\Delta\\theta}\\right)^2 + \\left(\\frac{u(\\Delta t)}{\\Delta t}\\right)^2} =\\sqrt{\\left(\\frac{${res.uDeltaThetaB.toFixed(6)}}{${res.deltaTheta}}\\right)^2 + \\left(\\frac{${res.uDeltaTB.toFixed(6)}}{${res.deltaT}}\\right)^2} = ${Math.sqrt(res.relDthetaDt2).toFixed(6)}$</div>
        </div>

        <div class="calculation-step">
            <div class="step-title">6. 热导率 K 计算</div>
            <div class="step-formula">$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}t} = ${res.dthetaDt.toFixed(6)}\\,\\mathrm{°C/s}$</div>
            <div class="step-formula">$\\frac{d_p+4h_p}{d_p+2h_p} = \\frac{${res.avgDp.toFixed(6)}+4×${res.avgHp.toFixed(6)}}{${res.avgDp.toFixed(6)}+2×${res.avgHp.toFixed(6)}} = ${((res.avgDp + 4*res.avgHp) / (res.avgDp + 2*res.avgHp)).toFixed(6)}$</div>
            <div class="step-formula">$d_b = ${res.avgDb.toFixed(6)}\\,\\mathrm{mm} = ${(res.avgDb/1000).toFixed(6)}\\,\\mathrm{m}$, $\\frac{2}{\\pi d_b^2} = ${(2/(Math.PI*(res.avgDb/1000)**2)).toFixed(6)}$</div>
            <div class="step-formula">$$K = \\bar{m}_p C_p \\frac{\\mathrm{d}\\theta}{\\mathrm{d}t} \\cdot \\frac{d_p+4h_p}{d_p+2h_p} \\cdot \\frac{h_b}{\\theta_1-\\theta_2} \\cdot \\frac{2}{\\pi d_b^2}$$</div>
            <div class="step-formula">$$= ${(res.avgMass/1000).toFixed(6)} × 389 × ${res.dthetaDt.toFixed(6)} × ${((res.avgDp + 4*res.avgHp) / (res.avgDp + 2*res.avgHp)).toFixed(6)} × \\frac{${(res.avgHb/1000).toFixed(6)}}{${res.thetaDiff.toFixed(6)}} × ${(2/(Math.PI*(res.avgDb/1000)**2)).toFixed(6)}$$</div>
            <div class="step-result">$K = ${res.K.toFixed(6)}\\ \\mathrm{W/(m·K)}$</div>
        </div>

        <div class="calculation-step">
            <div class="step-title">7. 相对不确定度合成</div>
            <div class="step-formula">$$\\frac{u(K)}{K} = \\sqrt{ \\left(\\frac{u(m_p)}{m_p}\\right)^2 + \\left(\\frac{u(\\mathrm{d}\\theta/\\mathrm{d}t)}{\\mathrm{d}\\theta/\\mathrm{d}t}\\right)^2 + \\left[\\frac{2h_p u(d_p)}{(d_p+4h_p)(d_p+2h_p)}\\right]^2 + \\left[\\frac{2d_p u(h_p)}{(d_p+4h_p)(d_p+2h_p)}\\right]^2 + \\left(\\frac{u(h_b)}{h_b}\\right)^2 + \\left(\\frac{2u(d_b)}{d_b}\\right)^2 + \\left(\\frac{u(\\theta_1-\\theta_2)}{\\theta_1-\\theta_2}\\right)^2 }$$</div>
            <div class="step-formula">$$= \\sqrt{ (${(res.uMassC/res.avgMass).toFixed(6)})^2 + (${Math.sqrt(res.relDthetaDt2).toFixed(6)})^2 + (${Math.sqrt(res.relGeo2).toFixed(6)})^2 + (${(res.uHbC/res.avgHb).toFixed(6)})^2 + (${(2*res.uDbC/res.avgDb).toFixed(6)})^2 + (${(res.uThetaDiff/res.thetaDiff).toFixed(6)})^2 } = ${res.relU.toFixed(6)}$$</div>
            <div class="step-result">$u(K) = K × \\frac{u(K)}{K} = ${res.K.toFixed(6)} × ${res.relU.toFixed(6)} = ${res.uK.toFixed(6)}\\ \\mathrm{W/(m·K)}$</div>
        </div>

        <div class="calculation-step">
            <div class="step-title">8. 最终结果</div>
            <div class="step-result" style="font-size:1.2rem;">$K = (${kDisplay} \\pm ${ukDisplay})\\ \\mathrm{W/(m·K)}$</div>
            <div class="step-result">相对不确定度 = $\\frac{u(K)}{K} = ${(res.relU*100).toFixed(2)}$ %</div>
        </div>
        `;

        document.getElementById('calculationProcess').innerHTML = html;
        window.ExperimentUtils.renderMath(document.getElementById('calculationProcess'));
    }

    // ---------- 显示主要结果 ----------
    function displayResults(res) {
        const [kRoundedStr, ukRoundedStr] = window.ExperimentUtils.formatResultWithUncertainty(res.K, res.uK);
        document.getElementById('k_val').innerText = kRoundedStr;
        document.getElementById('uk_val').innerText = ukRoundedStr;
        document.getElementById('rel_uk_val').innerText = res.relU.toFixed(6);
        renderProcess(res);
        document.getElementById('resultMain').style.display = 'block';
        document.getElementById('processSection').style.display = 'block';
    }

    // ---------- 计算入口 ----------
    function calculate() {
        const data = getInputs();
        if (!isValid(data)) {
            alert('数据不完整或格式错误，请确保所有测量值已填满且 θ₁ > θ₂, Δt > 0');
            return;
        }
        try {
            const results = compute(data);
            displayResults(results);
            window.ExperimentUtils.Storage.saveFromInputs(APP_KEY);
        } catch (e) {
            console.error(e);
            alert('计算过程出错，请检查数据');
        }
    }

    function saveOnly() {
        window.ExperimentUtils.Storage.saveFromInputs(APP_KEY);
        alert('数据已保存');
    }

    // ---------- 页面初始化 ----------
    window.addEventListener('DOMContentLoaded', function() {
        // 使用 TableGenerator 生成表格
        const TableGenerator = window.ExperimentUtils.TableGenerator;

        // 散热盘P表格：5行3列，默认值按行优先排列
        TableGenerator.generateInputTable('p-table-container', {
            rows: 5,
            cols: 3,
            colHeaders: ['次数', '质量 $m_p$ (g)', '高度 $h_p$ (mm)', '直径 $d_p$ (mm)'],
            rowHeaders: ['1', '2', '3', '4', '5'],
            prefix: 'p_',
            defaultValues: [856.2, 9.92, 79.98, 856.4, 9.94, 80.02, 856.0, 9.90, 80.00, 856.3, 9.93, 79.99, 856.1, 9.91, 80.01]
        });

        // 样品B表格：5行2列
        TableGenerator.generateInputTable('b-table-container', {
            rows: 5,
            cols: 2,
            colHeaders: ['次数', '高度 $h_b$ (mm)', '直径 $d_b$ (mm)'],
            rowHeaders: ['1', '2', '3', '4', '5'],
            prefix: 'b_',
            defaultValues: [8.12, 39.98, 8.14, 40.02, 8.10, 40.00, 8.13, 39.99, 8.11, 40.01]
        });

        // 若本地无数据，则使用默认示例（已通过 defaultValues 设置）
        if (!localStorage.getItem(APP_KEY)) {
            // 设置其他参数
            document.getElementById('theta1').value = '85.3';
            document.getElementById('theta2').value = '45.7';
            document.getElementById('deltaTheta').value = '12.8';
            document.getElementById('deltaT').value = '320';
        }

        // 加载保存数据（会覆盖默认值）
        window.ExperimentUtils.Storage.loadToInputs(APP_KEY);

        // 键盘导航
        window.ExperimentUtils.KeyboardNav.init('#p-table-container', 3);
        window.ExperimentUtils.KeyboardNav.init('#b-table-container', 2);

        // 深色模式
        window.ExperimentUtils.ThemeManager.init();

        // 绑定按钮
        document.getElementById('calculateBtn').addEventListener('click', calculate);
        document.getElementById('saveBtn').addEventListener('click', saveOnly);
    });
})();
</script>
</body>
</html>