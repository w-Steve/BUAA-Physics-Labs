<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®éªŒ 4-2: ç”µæ¡¥æ³•æµ‹ç”µé˜»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, hsl(219, 60%, 80%) 0%, #b2d2e0 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 24px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 12px;
        }
        
        .section {
            margin-bottom: 28px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            background-color: #fafafa;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 16px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .section-content {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 12px;
        }
        
        .input-item {
            flex: 1;
            min-width: 200px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .input-field {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-field:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .data-table {
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .table-title {
            font-weight: bold;
            margin-bottom: 12px;
            color: #2c3e50;
        }
        
        .table-header, .table-row {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header-cell, .cell {
            flex: 1;
            padding: 10px 8px;
            text-align: center;
            font-weight: 500;
        }
        
        .header-cell {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        
        .cell-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 140px;
        }
        
        .btn-calculate {
            background-color: #3498db;
            color: white;
        }
        
        .btn-calculate:hover {
            background-color: #2980b9;
        }
        
        .btn-calculate:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .btn-save {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #27ae60;
        }
        
        .results-group {
            background-color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .result-item.highlight {
            font-weight: bold;
            font-size: 18px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
        }
        
        .result-label {
            font-weight: 500;
        }
        
        .result-value {
            font-weight: bold;
            color: #3498db;
        }
        
        .intermediate-results, .uncertainty-details {
            background-color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .result-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 16px;
            color: #2c3e50;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }
        
        .uncertainty-group {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .group-title {
            font-weight: bold;
            margin-bottom: 12px;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .data-status {
            background-color: white;
            padding: 16px;
            border-radius: 8px;
        }
        
        .status-item {
            display: block;
            margin-bottom: 8px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            .input-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .input-item {
                min-width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-title">ç”µæ¡¥æ³•æµ‹ç”µé˜»</div>
        <div class="experiment-content">
            <!-- å®éªŒç®€ä»‹ -->
            <div class="section">
                <div class="section-title">ğŸ“ ä½¿ç”¨å¿…è¯»</div>
                <div class="section-content">
                    <p style="margin-top: 10px; color: #e74c3c;">Râ‚™ å’Œ Râ‚™' ä¸ºç”µæ¡¥å¹³è¡¡æ—¶çš„ä¸¤æ¬¡ç”µé˜»ç®±è¯»æ•°ã€‚</p>
                    <p style="margin-top: 10px; color: #e74c3c;">Î”x ä¸ºæ£€æµè®¡åè½¬æ ¼æ•°ï¼ŒÎ”R ä¸ºå¼•èµ·è¯¥åè½¬çš„ç”µé˜»å˜åŒ–å€¼ã€‚</p>
                    <p style="margin-top: 10px; color: #e74c3c;">ç”µé˜»ç®±æ®‹ä½™è¯¯å·® Râ‚€ éœ€å•ç‹¬æµ‹é‡æˆ–æŸ¥é˜…è¯´æ˜ä¹¦ã€‚</p>
                    <p style="margin-top: 10px; color: #e74c3c;">å‡†ç¡®åº¦ç­‰çº§ aáµ¢ æ ¹æ®ç”µé˜»ç®±å„æ¡£ä½çš„æ ‡ç§°ç­‰çº§å¡«å†™ã€‚</p>
                </div>
            </div>

            <!-- åŸå§‹æ•°æ®è¾“å…¥ -->
            <div class="section">
                <div class="section-title">ğŸ“Š åŸå§‹æ•°æ®è®°å½•</div>
                
                <!-- åŸºæœ¬æµ‹é‡æ•°æ® -->
                <div class="input-group">
                    <div class="input-row">
                        <div class="input-item">
                            <label class="input-label">Râ‚™ (Î©):</label>
                            <input 
                                class="input-field" 
                                type="number" 
                                placeholder="0.0" 
                                id="rn"
                                step="0.1"
                            />
                        </div>
                        <div class="input-item">
                            <label class="input-label">Râ‚™' (Î©):</label>
                            <input 
                                class="input-field" 
                                type="number" 
                                placeholder="0.0" 
                                id="rnPrime"
                                step="0.1"
                            />
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-item">
                            <label class="input-label">Î”x (æ ¼):</label>
                            <input 
                                class="input-field" 
                                type="number" 
                                placeholder="0.0" 
                                id="deltaX"
                                step="0.1"
                            />
                        </div>
                        <div class="input-item">
                            <label class="input-label">Î”R (Î©):</label>
                            <input 
                                class="input-field" 
                                type="number" 
                                placeholder="0.0" 
                                id="deltaR"
                                step="0.01"
                            />
                        </div>
                    </div>
                </div>

                <!-- ç”µé˜»ç®±æ®‹ä½™è¯¯å·® -->
                <div class="input-group">
                    <div class="input-item">
                        <label class="input-label">ç”µé˜»ç®±æ®‹ä½™è¯¯å·® Râ‚€ (Î©):</label>
                        <input 
                            class="input-field" 
                            type="number" 
                            placeholder="0.00" 
                            id="r0"
                            step="0.001"
                        />
                    </div>
                </div>

                <!-- ç”µé˜»ç®±å‡†ç¡®åº¦ç­‰çº§è¡¨ -->
                <div class="data-table">
                    <div class="table-title">ç”µé˜»ç®±å‡†ç¡®åº¦ç­‰çº§</div>
                    <div class="table-header">
                        <div class="header-cell">ç¤ºå€¼ç›˜ Ráµ¢ (Î©)</div>
                        <div class="header-cell">1000</div>
                        <div class="header-cell">100</div>
                        <div class="header-cell">10</div>
                        <div class="header-cell">1</div>
                        <div class="header-cell">0.1</div>
                    </div>
                    <div class="table-row">
                        <div class="cell">å‡†ç¡®åº¦ç­‰çº§ aáµ¢ (%)</div>
                        <input class="cell-input" type="number" placeholder="0.1" id="a1000" step="0.01" />
                        <input class="cell-input" type="number" placeholder="0.1" id="a100" step="0.01" />
                        <input class="cell-input" type="number" placeholder="0.1" id="a10" step="0.01" />
                        <input class="cell-input" type="number" placeholder="0.5" id="a1" step="0.01" />
                        <input class="cell-input" type="number" placeholder="5.0" id="a01" step="0.1" />
                    </div>
                </div>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div class="action-buttons">
                <button class="btn-calculate" id="calculateBtn">ğŸ§® å¼€å§‹è®¡ç®—</button>
                <button class="btn-save" id="saveBtn">ğŸ’¾ ä¿å­˜æ•°æ®</button>
            </div>
            
            <!-- è®¡ç®—ç»“æœ -->
            <div class="section" id="resultsSection" style="display: none;">
                <div class="section-title">ğŸ§® è®¡ç®—ç»“æœ</div>
                
                <div class="results-group">
                    <div class="result-item highlight">
                        <div class="result-label">å¾…æµ‹ç”µé˜» Râ‚“:</div>
                        <div class="result-value" id="rxValue">0.000 Î©</div>
                    </div>
                    <div class="result-item highlight">
                        <div class="result-label">ä¸ç¡®å®šåº¦ u(Râ‚“):</div>
                        <div class="result-value" id="uRxValue">0.000 Î©</div>
                    </div>
                    <div class="result-item highlight">
                        <div class="result-label">ç›¸å¯¹ä¸ç¡®å®šåº¦ u(Râ‚“)/Râ‚“:</div>
                        <div class="result-value" id="relativeUncertainty">0.000</div>
                    </div>
                    <div class="result-item highlight">
                        <div class="result-label">ç”µæ¡¥çµæ•åº¦ S:</div>
                        <div class="result-value" id="sensitivityValue">0.000 æ ¼/Î©</div>
                    </div>
                    <div class="result-item highlight">
                        <div class="result-label">çµæ•åº¦ä¸ç¡®å®šåº¦ u(S):</div>
                        <div class="result-value" id="uSensitivityValue">0.000 æ ¼/Î©</div>
                    </div>
                </div>

                <!-- ä¸­é—´è®¡ç®—ç»“æœ -->
                <div class="intermediate-results">
                    <div class="result-title">ä¸­é—´è®¡ç®—ç»“æœ</div>
                    <div class="result-item">
                        <div class="result-label">Râ‚™ çš„è¯¯å·® Î”Râ‚™:</div>
                        <div class="result-value" id="deltaRnValue">0.000 Î©</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Râ‚™' çš„è¯¯å·® Î”Râ‚™':</div>
                        <div class="result-value" id="deltaRnPrimeValue">0.000 Î©</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Râ‚™ çš„ä¸ç¡®å®šåº¦ u(Râ‚™):</div>
                        <div class="result-value" id="uRnValue">0.000 Î©</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Râ‚™' çš„ä¸ç¡®å®šåº¦ u(Râ‚™'):</div>
                        <div class="result-value" id="uRnPrimeValue">0.000 Î©</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">çµæ•åº¦å¼•èµ·çš„è¯¯å·® Î”çµ:</div>
                        <div class="result-value" id="deltaSensitivityError">0.000 Î©</div>
                    </div>
                </div>

                <!-- ä¸ç¡®å®šåº¦åˆ†é‡è¯¦æƒ… -->
                <div class="uncertainty-details">
                    <div class="result-title">ä¸ç¡®å®šåº¦åˆ†é‡åˆ†æ</div>
                    
                    <!-- Râ‚™ ä¸ç¡®å®šåº¦ -->
                    <div class="uncertainty-group">
                        <div class="group-title">Râ‚™ çš„ä¸ç¡®å®šåº¦</div>
                        <div class="result-item">
                            <div class="result-label">è¯¯å·® Î”Râ‚™:</div>
                            <div class="result-value" id="deltaRnDetail">0.000 Î©</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Bç±»ä¸ç¡®å®šåº¦ u(Râ‚™):</div>
                            <div class="result-value" id="uRnDetail">0.000 Î©</div>
                        </div>
                    </div>

                    <!-- Râ‚™' ä¸ç¡®å®šåº¦ -->
                    <div class="uncertainty-group">
                        <div class="group-title">Râ‚™' çš„ä¸ç¡®å®šåº¦</div>
                        <div class="result-item">
                            <div class="result-label">è¯¯å·® Î”Râ‚™':</div>
                            <div class="result-value" id="deltaRnPrimeDetail">0.000 Î©</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Bç±»ä¸ç¡®å®šåº¦ u(Râ‚™'):</div>
                            <div class="result-value" id="uRnPrimeDetail">0.000 Î©</div>
                        </div>
                    </div>

                    <!-- çµæ•åº¦ç›¸å…³ä¸ç¡®å®šåº¦ -->
                    <div class="uncertainty-group">
                        <div class="group-title">çµæ•åº¦ç›¸å…³å‚æ•°</div>
                        <div class="result-item">
                            <div class="result-label">çµæ•åº¦ S:</div>
                            <div class="result-value" id="sensitivityDetail">0.000 æ ¼/Î©</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">çµæ•åº¦è¯¯å·® Î”çµ:</div>
                            <div class="result-value" id="deltaSensitivityDetail">0.000 Î©</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">çµæ•åº¦ä¸ç¡®å®šåº¦ u(S):</div>
                            <div class="result-value" id="uSensitivityDetail">0.000 æ ¼/Î©</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®çŠ¶æ€ -->
            <div class="section">
                <div class="section-title">ğŸ’¾ æ•°æ®çŠ¶æ€</div>
                <div class="data-status">
                    <div class="status-item">æœ€åæ›´æ–°: <span id="lastUpdate">æš‚æ— æ•°æ®</span></div>
                </div>
                <div style="margin-top: 15px; font-size: 12px; color: #7f8c8d; text-align: center;">
                    ä¸ä¿è¯è®¡ç®—ç»“æœçš„ç»å¯¹å‡†ç¡®æ€§ï¼Œç”¨æˆ·åº”è‡ªè¡Œæ ¸å¯¹é‡è¦æ•°æ®çš„è®¡ç®—ç»“æœï¼Œå¼€å‘è€…ä¸å¯¹å› ä½¿ç”¨æœ¬è½¯ä»¶é€ æˆçš„ä»»ä½•æŸå¤±è´Ÿè´£
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®éªŒæ•°æ®æ¨¡å‹
        const experimentData = {
            experimentId: '4-2',
            // åŸºæœ¬å‚æ•°
            rn: '',
            rnPrime: '',
            deltaX: '',
            deltaR: '',
            r0: '',
            // å‡†ç¡®åº¦ç­‰çº§
            a1000: '0.1',
            a100: '0.1',
            a10: '0.1',
            a1: '0.5',
            a01: '5.0',
            // è®¡ç®—ç»“æœ
            showResults: false,
            rxValue: '0.000',
            uRxValue: '0.000',
            relativeUncertainty: '0.000',
            sensitivityValue: '0.000',
            uSensitivityValue: '0.000',
            // ä¸­é—´ç»“æœ
            deltaRnValue: '0.000',
            deltaRnPrimeValue: '0.000',
            uRnValue: '0.000',
            uRnPrimeValue: '0.000',
            deltaSensitivityError: '0.000',
            // è¯¦ç»†ç»“æœ
            deltaRnDetail: '0.000',
            uRnDetail: '0.000',
            deltaRnPrimeDetail: '0.000',
            uRnPrimeDetail: '0.000',
            sensitivityDetail: '0.000',
            deltaSensitivityDetail: '0.000',
            uSensitivityDetail: '0.000',
            // çŠ¶æ€
            lastUpdate: ''
        };

        // DOM å…ƒç´ 
        const elements = {
            // è¾“å…¥å…ƒç´ 
            rn: document.getElementById('rn'),
            rnPrime: document.getElementById('rnPrime'),
            deltaX: document.getElementById('deltaX'),
            deltaR: document.getElementById('deltaR'),
            r0: document.getElementById('r0'),
            a1000: document.getElementById('a1000'),
            a100: document.getElementById('a100'),
            a10: document.getElementById('a10'),
            a1: document.getElementById('a1'),
            a01: document.getElementById('a01'),
            // æŒ‰é’®
            calculateBtn: document.getElementById('calculateBtn'),
            saveBtn: document.getElementById('saveBtn'),
            // ç»“æœæ˜¾ç¤ºå…ƒç´ 
            resultsSection: document.getElementById('resultsSection'),
            rxValue: document.getElementById('rxValue'),
            uRxValue: document.getElementById('uRxValue'),
            relativeUncertainty: document.getElementById('relativeUncertainty'),
            sensitivityValue: document.getElementById('sensitivityValue'),
            uSensitivityValue: document.getElementById('uSensitivityValue'),
            // ä¸­é—´ç»“æœ
            deltaRnValue: document.getElementById('deltaRnValue'),
            deltaRnPrimeValue: document.getElementById('deltaRnPrimeValue'),
            uRnValue: document.getElementById('uRnValue'),
            uRnPrimeValue: document.getElementById('uRnPrimeValue'),
            deltaSensitivityError: document.getElementById('deltaSensitivityError'),
            // è¯¦ç»†ç»“æœ
            deltaRnDetail: document.getElementById('deltaRnDetail'),
            uRnDetail: document.getElementById('uRnDetail'),
            deltaRnPrimeDetail: document.getElementById('deltaRnPrimeDetail'),
            uRnPrimeDetail: document.getElementById('uRnPrimeDetail'),
            sensitivityDetail: document.getElementById('sensitivityDetail'),
            deltaSensitivityDetail: document.getElementById('deltaSensitivityDetail'),
            uSensitivityDetail: document.getElementById('uSensitivityDetail'),
            // çŠ¶æ€
            lastUpdate: document.getElementById('lastUpdate')
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadExperimentData();
            setupEventListeners();
            updateCalculateStatus();
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // åŸºæœ¬å‚æ•°è¾“å…¥
            elements.rn.addEventListener('input', onRnChange);
            elements.rnPrime.addEventListener('input', onRnPrimeChange);
            elements.deltaX.addEventListener('input', onDeltaXChange);
            elements.deltaR.addEventListener('input', onDeltaRChange);
            elements.r0.addEventListener('input', onR0Change);
            
            // å‡†ç¡®åº¦ç­‰çº§è¾“å…¥
            elements.a1000.addEventListener('input', onAccuracyChange);
            elements.a100.addEventListener('input', onAccuracyChange);
            elements.a10.addEventListener('input', onAccuracyChange);
            elements.a1.addEventListener('input', onAccuracyChange);
            elements.a01.addEventListener('input', onAccuracyChange);

            // æŒ‰é’®äº‹ä»¶
            elements.calculateBtn.addEventListener('click', calculateResults);
            elements.saveBtn.addEventListener('click', saveData);
        }

        // è¾“å…¥å¤„ç†å‡½æ•°
        function onRnChange(e) {
            experimentData.rn = e.target.value;
            updateCalculateStatus();
        }

        function onRnPrimeChange(e) {
            experimentData.rnPrime = e.target.value;
            updateCalculateStatus();
        }

        function onDeltaXChange(e) {
            experimentData.deltaX = e.target.value;
            updateCalculateStatus();
        }

        function onDeltaRChange(e) {
            experimentData.deltaR = e.target.value;
            updateCalculateStatus();
        }

        function onR0Change(e) {
            experimentData.r0 = e.target.value;
            updateCalculateStatus();
        }

        function onAccuracyChange(e) {
            const id = e.target.id;
            experimentData[id] = e.target.value;
            updateCalculateStatus();
        }

        // æ›´æ–°è®¡ç®—æŒ‰é’®çŠ¶æ€
        function updateCalculateStatus() {
            const hasBasicData = experimentData.rn && experimentData.rnPrime && 
                               experimentData.deltaX && experimentData.deltaR &&
                               experimentData.r0;
            
            const hasAccuracyData = experimentData.a1000 && experimentData.a100 && 
                                  experimentData.a10 && experimentData.a1 && 
                                  experimentData.a01;
            
            const canCalculate = hasBasicData && hasAccuracyData;
            
            elements.calculateBtn.disabled = !canCalculate;
        }

        // è®¡ç®—åŠŸèƒ½
        function calculateResults() {
            try {
                // è§£æè¾“å…¥å€¼
                const rn = parseFloat(experimentData.rn);
                const rnPrime = parseFloat(experimentData.rnPrime);
                const deltaX = parseFloat(experimentData.deltaX);
                const deltaR = parseFloat(experimentData.deltaR);
                const r0 = parseFloat(experimentData.r0);
                
                // è§£æå‡†ç¡®åº¦ç­‰çº§
                const accuracyLevels = {
                    '1000': parseFloat(experimentData.a1000) / 100,
                    '100': parseFloat(experimentData.a100) / 100,
                    '10': parseFloat(experimentData.a10) / 100,
                    '1': parseFloat(experimentData.a1) / 100,
                    '0.1': parseFloat(experimentData.a01) / 100
                };
                
                // 1. è®¡ç®—å¾…æµ‹ç”µé˜» Râ‚“ = âˆš(Râ‚™ Ã— Râ‚™')
                const rx = Math.sqrt(rn * rnPrime);
                
                // 2. è®¡ç®—ç”µé˜»ç®±è¯¯å·® Î”Râ‚– = Râ‚€â‚– + Î£(aáµ¢% Ã— Ráµ¢)
                const deltaRn = calculateResistorError(rn, r0, accuracyLevels);
                const deltaRnPrime = calculateResistorError(rnPrime, r0, accuracyLevels);
                
                // 3. è®¡ç®—ç”µé˜»ç®±ä¸ç¡®å®šåº¦ u(Râ‚–) = Î”Râ‚– / âˆš3
                const uRn = deltaRn / Math.sqrt(3);
                const uRnPrime = deltaRnPrime / Math.sqrt(3);
                
                // 4. è®¡ç®— Râ‚“ çš„ä¸ç¡®å®šåº¦
                const term1 = Math.pow(uRn / (2 * rn), 2);
                const term2 = Math.pow(uRnPrime / (2 * rnPrime), 2);
                const relativeUncertaintyRx = Math.sqrt(term1 + term2);
                const uRx = rx * relativeUncertaintyRx;
                
                // 5. è®¡ç®—ç”µæ¡¥çµæ•åº¦ S = Î”x / Î”R
                const sensitivity = deltaX / deltaR;
                
                // 6. è®¡ç®—çµæ•åº¦å¼•èµ·çš„è¯¯å·® Î”çµ = 0.2 / S
                const deltaSensitivityError = 0.2 / sensitivity;
                
                // 7. è®¡ç®—çµæ•åº¦ä¸ç¡®å®šåº¦ u(S) = Î”çµ / âˆš3
                const uSensitivity = deltaSensitivityError / Math.sqrt(3);
                
                // ä¿å­˜è®¡ç®—ç»“æœ
                experimentData.rxValue = rx.toFixed(6);
                experimentData.uRxValue = uRx.toFixed(6);
                experimentData.relativeUncertainty = relativeUncertaintyRx.toFixed(6);
                experimentData.sensitivityValue = sensitivity.toFixed(6);
                experimentData.uSensitivityValue = uSensitivity.toFixed(6);
                
                // ä¸­é—´ç»“æœ
                experimentData.deltaRnValue = deltaRn.toFixed(6);
                experimentData.deltaRnPrimeValue = deltaRnPrime.toFixed(6);
                experimentData.uRnValue = uRn.toFixed(6);
                experimentData.uRnPrimeValue = uRnPrime.toFixed(6);
                experimentData.deltaSensitivityError = deltaSensitivityError.toFixed(6);
                
                // è¯¦ç»†ç»“æœ
                experimentData.deltaRnDetail = deltaRn.toFixed(6);
                experimentData.uRnDetail = uRn.toFixed(6);
                experimentData.deltaRnPrimeDetail = deltaRnPrime.toFixed(6);
                experimentData.uRnPrimeDetail = uRnPrime.toFixed(6);
                experimentData.sensitivityDetail = sensitivity.toFixed(6);
                experimentData.deltaSensitivityDetail = deltaSensitivityError.toFixed(6);
                experimentData.uSensitivityDetail = uSensitivity.toFixed(6);
                
                // æ˜¾ç¤ºç»“æœ
                displayResults();
                
                alert('è®¡ç®—å®Œæˆï¼');
            } catch (error) {
                console.error('è®¡ç®—é”™è¯¯:', error);
                alert('è®¡ç®—å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®');
            }
        }

        // è®¡ç®—ç”µé˜»ç®±è¯¯å·® Î”Râ‚– = Râ‚€ + Î£(aáµ¢% Ã— Ráµ¢)
        function calculateResistorError(resistance, r0, accuracyLevels) {
            let error = r0;
            
            // åˆ†è§£ç”µé˜»å€¼ä¸ºå„æ¡£ä½çš„è´¡çŒ®
            const values = resistance.toString().split('.');
            const integerPart = values[0];
            const decimalPart = values[1] || '';
            
            // å¤„ç†æ•´æ•°éƒ¨åˆ†ï¼ˆÎ©ï¼‰
            for (let i = 0; i < integerPart.length; i++) {
                const digit = parseInt(integerPart[i]);
                const position = integerPart.length - 1 - i;
                const multiplier = Math.pow(10, position);
                
                if (multiplier >= 0.1) {
                    const levelKey = multiplier.toString();
                    if (accuracyLevels[levelKey]) {
                        error += accuracyLevels[levelKey] * (digit * multiplier);
                    }
                }
            }
            
            // å¤„ç†å°æ•°éƒ¨åˆ†ï¼ˆ0.1Î©æ¡£ï¼‰
            if (decimalPart.length > 0) {
                const firstDecimal = parseInt(decimalPart.charAt(0));
                if (firstDecimal > 0 && accuracyLevels['0.1']) {
                    error += accuracyLevels['0.1'] * (firstDecimal * 0.1);
                }
            }
            
            return error;
        }

        // æ˜¾ç¤ºè®¡ç®—ç»“æœ
        function displayResults() {
            // ä¸»è¦ç»“æœ
            elements.rxValue.textContent = `${experimentData.rxValue} Î©`;
            elements.uRxValue.textContent = `${experimentData.uRxValue} Î©`;
            elements.relativeUncertainty.textContent = experimentData.relativeUncertainty;
            elements.sensitivityValue.textContent = `${experimentData.sensitivityValue} æ ¼/Î©`;
            elements.uSensitivityValue.textContent = `${experimentData.uSensitivityValue} æ ¼/Î©`;
            
            // ä¸­é—´ç»“æœ
            elements.deltaRnValue.textContent = `${experimentData.deltaRnValue} Î©`;
            elements.deltaRnPrimeValue.textContent = `${experimentData.deltaRnPrimeValue} Î©`;
            elements.uRnValue.textContent = `${experimentData.uRnValue} Î©`;
            elements.uRnPrimeValue.textContent = `${experimentData.uRnPrimeValue} Î©`;
            elements.deltaSensitivityError.textContent = `${experimentData.deltaSensitivityError} Î©`;
            
            // è¯¦ç»†ç»“æœ
            elements.deltaRnDetail.textContent = `${experimentData.deltaRnDetail} Î©`;
            elements.uRnDetail.textContent = `${experimentData.uRnDetail} Î©`;
            elements.deltaRnPrimeDetail.textContent = `${experimentData.deltaRnPrimeDetail} Î©`;
            elements.uRnPrimeDetail.textContent = `${experimentData.uRnPrimeDetail} Î©`;
            elements.sensitivityDetail.textContent = `${experimentData.sensitivityDetail} æ ¼/Î©`;
            elements.deltaSensitivityDetail.textContent = `${experimentData.deltaSensitivityDetail} Î©`;
            elements.uSensitivityDetail.textContent = `${experimentData.uSensitivityDetail} æ ¼/Î©`;
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            elements.resultsSection.style.display = 'block';
            experimentData.showResults = true;
        }

        // ä¿å­˜æ•°æ®åˆ°localStorage
        function saveData() {
            try {
                experimentData.lastUpdate = new Date().toLocaleString();
                localStorage.setItem('experiment4-2', JSON.stringify(experimentData));
                elements.lastUpdate.textContent = experimentData.lastUpdate;
                alert('æ•°æ®ä¿å­˜æˆåŠŸï¼');
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // ä»localStorageåŠ è½½æ•°æ®
        function loadExperimentData() {
            try {
                const savedData = localStorage.getItem('experiment4-2');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // æ¢å¤åŸºæœ¬å‚æ•°
                    elements.rn.value = data.rn || '';
                    elements.rnPrime.value = data.rnPrime || '';
                    elements.deltaX.value = data.deltaX || '';
                    elements.deltaR.value = data.deltaR || '';
                    elements.r0.value = data.r0 || '';
                    
                    // æ¢å¤å‡†ç¡®åº¦ç­‰çº§
                    elements.a1000.value = data.a1000 || '0.1';
                    elements.a100.value = data.a100 || '0.1';
                    elements.a10.value = data.a10 || '0.1';
                    elements.a1.value = data.a1 || '0.5';
                    elements.a01.value = data.a01 || '5.0';
                    
                    // æ¢å¤è®¡ç®—ç»“æœ
                    if (data.showResults) {
                        Object.assign(experimentData, data);
                        displayResults();
                    }
                    
                    // æ¢å¤æœ€åæ›´æ–°æ—¶é—´
                    if (data.lastUpdate) {
                        elements.lastUpdate.textContent = data.lastUpdate;
                    }
                    
                    // æ›´æ–°è®¡ç®—çŠ¶æ€
                    updateCalculateStatus();
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }
    </script>
</body>
</html>